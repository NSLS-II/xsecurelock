#!/usr/bin/make -f
# -*- makefile -*-
#
#  # Use already defined upstream version as DEB_VERSION_UPSTREAM.
include /usr/share/dpkg/pkg-info.mk

export DH_VERBOSE=1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all

%:
	dh $@ --with autoreconf

override_dh_auto_configure:
	    dh_auto_configure -- \
			--with-pam \
			--with-pam-service-name=xsecurelock \
			--with-userfile-filename=/etc/xsecurelock/users \
			--with-banner-filename=/etc/xsecurelock/banner \
			--enable-any-user-auth \
			--enable-banner \
			--enable-wallpaper \
			--enable-no-blank \
			--with-fontconfig \
			--with-htpasswd=no \
			--with-mplayer=/usr/bin/mplayer \
			--with-mpv=/usr/bin/mpv \
			--with-pamtester=no \
			--with-xcomposite \
			--with-xf86misc=no \
			--with-xrandr \
			--with-xss \
			--with-xsync \
			--with-xfixes \
			--with-xft \
			--with-xkb

override_dh_auto_build:
		GIT_VERSION="$(DEB_VERSION_UPSTREAM)" dh_auto_build

override_dh_autoreconf:
		dh_autoreconf ./autogen.sh

override_dh_auto_install:
		dh_auto_install
		find ./debian -type f -name "LICENSE" -delete
		install -d -m 755 $(DESTDIR)/etc/xsecurelock
		install -m 644 debian/banner $(DESTDIR)/etc/xsecurelock/banner
		install -m 644 debian/users $(DESTDIR)/etc/xsecurelock/users
		install -m 644 debian/xsecurelock $(DESTDIR)/etc/pam.d/xsecurelock

override_dh_auto_clean:
		dh_auto_clean
		-rm version.c
